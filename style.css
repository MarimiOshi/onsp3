/* ================================================================== */
/* style.css - ONSP Project (TikTok UI Base & Fixes)                */
/* ================================================================== */

:root {
    --default-accent-color: #6c757d; --default-main-bg: #f0f2f5; --default-content-bg: #ffffff;
    --default-text-color: #343a40; --default-border-color: #dee2e6;
    --member-accent-color: var(--default-accent-color); --member-main-bg: var(--default-main-bg);
    --member-content-bg: var(--default-content-bg); --member-text-color: var(--default-text-color);
    --member-button-text-color: #ffffff;
    --pulse-duration: 2s; --pulse-brightness-factor: 1.3; --pulse-hue: 0; --pulse-sat: 0%; --pulse-light: 80%;
    --member-accent-color-rgb: 108, 117, 125;
    --shiko-animation-duration: 1000ms;

    /* TikTok風UI用 */
    --tiktok-bg-color: #000; /* TikTokは黒背景が多い */
    --tiktok-text-color: #fff;
    --tiktok-icon-size: 30px;
    --tiktok-bottom-nav-height: 50px; /* 下部タブナビの高さ */
    --tiktok-footer-controls-height: 70px; /* しこしこモード下部固定ボタンの高さ */
}

html { height: 100%; box-sizing: border-box; }
*, *:before, *:after { box-sizing: inherit; }

body {
    font-family: 'Hiragino Kaku Gothic ProN', 'メイリオ', Meiryo, sans-serif;
    margin: 0;
    background-color: var(--tiktok-bg-color); /* 基本背景をTikTok風に */
    color: var(--tiktok-text-color); /* 基本文字色 */
    line-height: 1.6;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    display: flex; flex-direction: column;
    height: 100vh; /* スマホで全画面表示のため */
    height: 100svh; /* iOS Safariのバーを考慮したviewport height */
    overflow: hidden; /* スマホでの縦スクロール禁止 */
    position: relative; /* モーダルなどの基準 */
}

/* --- スクロールバー (PC用、スマホではほぼ見えない) --- */
::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #333; }
::-webkit-scrollbar-thumb { background-color: #666; border-radius: 3px; }
body { scrollbar-width: thin; scrollbar-color: #666 #333; }

/* --- タブナビゲーション (下部固定に変更) --- */
.tab-container-bottom-fixed {
    display: flex; justify-content: space-around;
    background-color: rgba(0, 0, 0, 0.85); /* 半透明黒 */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
    position: fixed; bottom: 0; left: 0; right: 0;
    height: var(--tiktok-bottom-nav-height);
    z-index: 1000;
    padding-bottom: env(safe-area-inset-bottom); /* iPhoneノッチ対応 */
}
.tab-container-bottom-fixed .tab-button {
    padding: 0; /* 上下paddingは高さで制御 */
    border: none; background-color: transparent; cursor: pointer;
    font-size: 0.8rem; color: #aaa; /* やや暗めの文字色 */
    border-top: 3px solid transparent; /* アクティブインジケータを上に */
    transition: color 0.2s, border-top-color 0.3s ease-out;
    font-weight: 500; text-align: center; position: relative; user-select: none;
    flex-grow: 1; display: flex; align-items: center; justify-content: center;
}
.tab-container-bottom-fixed .tab-button:hover { color: #fff; }
.tab-container-bottom-fixed .tab-button.active {
    color: var(--member-accent-color, #fff); /* アクティブ時はメンバーカラー or 白 */
    font-weight: 700;
}
.tab-container-bottom-fixed .tab-button.active::before { /* インジケータを上に変更 */
    content: ''; position: absolute; top: 0; left: 20%; right: 20%; height: 3px;
    background-color: var(--member-accent-color, #fff);
    border-radius: 0 0 2px 2px;
    transition: background-color 0.3s ease-in-out;
}


/* --- メインコンテンツエリア --- */
.app-main-content {
    flex-grow: 1;
    /* padding: 0; 全画面表示のためpadding削除 */
    width: 100%;
    height: calc(100% - var(--tiktok-bottom-nav-height) - env(safe-area-inset-bottom)); /* 下部ナビ分高さを引く */
    overflow-y: auto; /* モード内容がはみ出る場合はスクロール可能に (基本はさせない) */
    position: relative; /* 各モードセクションの基準 */
}

.mode-section {
    display: none;
    background-color: var(--tiktok-bg-color); /* モード背景もTikTok風に */
    /* padding: 15px; 全画面なのでpadding調整 */
    width: 100%;
    height: 100%; /* 親の高さ一杯に広がる */
    position: absolute; /* 重ねて表示 */
    top: 0; left: 0;
    overflow-y: auto; /* モード内のコンテンツがはみ出る場合のスクロール */
}
.mode-section.active { display: block; }
.mode-content-wrapper { height: 100%; display: flex; flex-direction: column; }
/* モードごとのタイトルはTikTok風UIでは画面上部に固定表示など工夫が必要。今回はシンプルに。*/
.mode-section > .mode-content-wrapper > h2 {
    color: var(--tiktok-text-color); text-align: center; font-size: 1.2rem;
    padding: 10px; background-color: rgba(0,0,0,0.5); margin:0; position: absolute; top:0; left:0; right:0; z-index: 10;
}

/* --- 共通UIコンポーネント (TikTok風に調整) --- */
.action-button {
    padding: 8px 15px; font-size: 0.9em; cursor: pointer;
    background-color: var(--member-accent-color, #f8f9fa); /* 背景はメンバーカラーか明るめ */
    color: var(--member-button-text-color, var(--tiktok-bg-color)); /* 文字色は背景に応じて */
    border: 1px solid rgba(255,255,255,0.2); /* 境界を少し出す */
    border-radius: 4px; transition: background-color 0.2s, opacity 0.2s, transform 0.1s;
    margin: 5px; font-weight: bold; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); user-select: none;
}
/* 他のボタン状態も同様に調整 */

/* --- しこしこモード (TikTok風UI) --- */
.shikoshiko-tiktok-ui {
    height: 100%; width: 100%;
    position: relative; /* 子要素のabsolute配置の基準 */
    display: flex; /* 基本は使わないが、念のため */
    overflow: hidden; /* はみ出し防止 */
    background-color: var(--member-main-bg, var(--tiktok-bg-color)); /* メンバーカラー背景 */
}
/* 左サイドパネル (プロフィールアイコン、いいね等) */
.tiktok-left-panel {
    position: absolute;
    left: 10px;
    bottom: calc(var(--tiktok-footer-controls-height) + 20px + env(safe-area-inset-bottom)); /* フッターコントロールの上 */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    z-index: 20;
}
.tiktok-profile-icon-container { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; border: 2px solid rgba(255,255,255,0.7); }
.tiktok-profile-icon { width: 100%; height: 100%; object-fit: cover; }
.tiktok-action-button { background: none; border: none; color: var(--tiktok-text-color); cursor: pointer; text-align: center; }
.tiktok-action-button .tiktok-icon { font-size: var(--tiktok-icon-size); display: block; }
.tiktok-action-button .tiktok-count { font-size: 0.7rem; display: block; margin-top: 2px; }
.tiktok-weak-point-button .tiktok-icon { /* ☆ or ★ */ transition: color 0.2s, transform 0.2s; }
.tiktok-weak-point-button.is-weak .tiktok-icon { color: #ffeb3b; /* 黄色 */ transform: scale(1.2); }

/* メイン画像表示エリア */
.member-image-container.tiktok-image-main {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; /* ステッカー用 */
    margin: 0; /* リセット */
}
#shikoshikoMemberImage {
    max-width: 100%; max-height: 100%;
    object-fit: contain; /* 画像がコンテナに収まるように */
    border: none; /* TikTok風では枠線なしが多い */
    box-shadow: none;
}

/* 下部情報エリア (ユーザー名、キャプション、音楽など) */
.tiktok-bottom-info {
    position: absolute;
    bottom: calc(var(--tiktok-footer-controls-height) + 10px + env(safe-area-inset-bottom)); /* フッターコントロールの上 */
    left: 10px; right: 10px; /* 左右マージン */
    color: var(--tiktok-text-color);
    z-index: 20;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* 文字の視認性向上 */
}
.member-quote.tiktok-quote { font-size: 0.9rem; font-style: normal; margin-bottom: 5px; text-align: left; }
.image-tags-container { margin-bottom: 5px; text-align: left; }
.image-tag-item { background-color: rgba(255,255,255,0.15); color: var(--tiktok-text-color); font-size: .65em; padding: 2px 5px; }

/* しこしこアニメーション (TikTok風では右下などに小さく表示も) */
.shiko-animation-container.tiktok-shiko-animation {
    position: absolute;
    right: 10px;
    bottom: calc(var(--tiktok-footer-controls-height) + 20px + env(safe-area-inset-bottom));
    width: 80px; height: 80px; /* サイズを小さく */
    z-index: 20;
    /* background-color: rgba(0,0,0,0.3); border-radius: 50%; */ /* 円形背景など */
}
.sao-image, .shikoshiko-image { /* サイズ統一 */
    width: 100%; height: 100%;
    object-fit: contain; /* 元画像の比率を保ちつつフィット */
}
.shikoshiko-image { bottom: 0; /* 位置調整 */ }


/* 設定ボタン */
.tiktok-settings-button {
    position: absolute; top: 15px; right: 15px; z-index: 30;
    background: rgba(0,0,0,0.3); border: none; color: var(--tiktok-text-color);
    font-size: 1.5rem; padding: 5px 8px; border-radius: 50%; cursor: pointer;
}

/* しこしこモード下部固定コントロール */
.game-controls-area-sticky-footer.shikoshiko-footer-controls {
    position: fixed; bottom: var(--tiktok-bottom-nav-height); /* タブナビの上 */
    left: 0; right: 0;
    height: var(--tiktok-footer-controls-height);
    background-color: rgba(0, 0, 0, 0.85);
    padding: 10px; padding-bottom: calc(10px + env(safe-area-inset-bottom)); /* 重複するが念のため */
    box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
    display: flex; justify-content: space-between; align-items: center;
    z-index: 100;
}
.shikoshiko-footer-controls .action-button { margin: 0; font-size: 0.9rem; flex-basis: 30%; text-align: center; }
.shikoshiko-footer-controls .main-action { flex-basis: 38%; font-size: 1rem; } /* スタート/フィニッシュ */


/* --- モーダル --- */
.modal {
    display: none; position: fixed; z-index: 2000; left: 0; top: 0;
    width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7);
    animation: modalFadeIn 0.3s ease-out;
}
@keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal-content {
    background-color: var(--default-content-bg); color: var(--default-text-color); /* 通常の配色に戻す */
    margin: 10% auto; padding: 20px; border: 1px solid #888;
    width: 90%; max-width: 500px; border-radius: 8px; position: relative;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2); animation: modalSlideIn 0.3s ease-out;
}
@keyframes modalSlideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.modal-close-button {
    color: #aaa; position: absolute; top: 10px; right: 15px;
    font-size: 28px; font-weight: bold; cursor: pointer;
}
.modal-close-button:hover, .modal-close-button:focus { color: black; text-decoration: none; }
.modal-content h2 { margin-top: 0; color: var(--default-text-color); text-align: center; }
.modal-body .setting-group { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
.modal-body .setting-group:last-child { border-bottom: none; }
.modal-footer { text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; }
.modal-sticker-choices { max-height: 120px; } /* モーダル内のステッカー選択肢の高さ */

/* 背景エフェクト (メンバーカラー時) */
body.shikoshiko-active:not(.no-pulse) {
    /* TikTok風UIでは背景画像や動画がメインなので、背景色点滅は控えめにするか、別のエフェクトを検討 */
    /* 例: animation: pulseBorder var(--pulse-duration, 2s) infinite ease-in-out; */
}
/* @keyframes pulseBorder { ... border-color をアニメーション ... } */

/* --- カウンターモード、ギャラリーモード (TikTok風UIを適用するなら大幅な変更が必要) --- */
/* 今回は既存のスタイルを維持しつつ、背景色と文字色のみ調整 */
#counterSection .mode-content-wrapper > h2,
#gallerySection .mode-content-wrapper > h2 {
    position: static; /* 通常のh2に戻す */
    background-color: transparent;
    margin-bottom: 20px;
}
#counterSection, #gallerySection {
    background-color: var(--default-content-bg); /* 通常の背景 */
    color: var(--default-text-color); /* 通常の文字色 */
    padding: 20px; /* 通常のpadding */
}
/* カウンター、ギャラリー内の各要素の色も必要に応じて調整 */
.counter-item { background-color: #fff; }
.gallery-item { background-color: #f8f9fa; }


/* --- レスポンシブ対応 --- */
@media (max-width: 768px) {
    .tab-container-bottom-fixed .tab-button { font-size: 0.7rem; }
    .app-main-content { height: calc(100% - var(--tiktok-bottom-nav-height) - env(safe-area-inset-bottom)); }
    .mode-section > .mode-content-wrapper > h2 { font-size: 1rem; padding: 8px; }

    .shikoshiko-tiktok-ui { /* スマホではこれが常に適用される */ }
    .tiktok-left-panel { left: 5px; bottom: calc(var(--tiktok-footer-controls-height) + 15px + env(safe-area-inset-bottom)); gap: 12px;}
    .tiktok-profile-icon-container { width: 35px; height: 35px; }
    .tiktok-action-button .tiktok-icon { font-size: calc(var(--tiktok-icon-size) * 0.8); }
    .tiktok-action-button .tiktok-count { font-size: 0.6rem; }
    .tiktok-bottom-info { left: 5px; right: 5px; bottom: calc(var(--tiktok-footer-controls-height) + 5px + env(safe-area-inset-bottom));}
    .member-quote.tiktok-quote { font-size: 0.8rem; }
    .image-tag-item { font-size: .6em; }
    .shiko-animation-container.tiktok-shiko-animation { width: 70px; height: 70px; right: 5px; bottom: calc(var(--tiktok-footer-controls-height) + 15px + env(safe-area-inset-bottom));}
    .tiktok-settings-button { font-size: 1.3rem; top: 10px; right: 10px; }

    .game-controls-area-sticky-footer.shikoshiko-footer-controls { height: var(--tiktok-footer-controls-height); }
    .shikoshiko-footer-controls .action-button { font-size: 0.8rem; padding: 8px 10px; }
    .shikoshiko-footer-controls .main-action { font-size: 0.9rem; } /* スタート/フィニッシュ */


    .modal-content { width: 95%; margin: 5% auto; padding: 15px; }
    .modal-body .setting-group { margin-bottom: 10px; }

    /* カウンター、ギャラリーのスマホ調整は前回同様 */
    .counter-grid { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px; }
    .counter-item { padding: 8px 5px; }
    .counter-item img { max-width: 40px; max-height: 40px; }
    .counter-item .counter-member-name { font-size: 0.7rem; }
    .counter-item .count-number { font-size: 1.1em; }
    .gallery-controls { flex-direction: column; align-items: stretch; gap: 8px; }
    .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
    .gallery-thumbnail { height: 100px; }
}
